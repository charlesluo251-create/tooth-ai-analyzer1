<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>牙齿 AI 检测助手</title>
    <style>
      :root { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; color: #1f2937; background: #f3f4f6; }
      body { margin: 0; min-height: 100vh; display: grid; place-items: center; }
      .card { width: min(760px, 92vw); background: #fff; border-radius: 16px; padding: 24px; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08); }
      h1 { margin-top: 0; }
      .hint { color: #4b5563; font-size: 14px; }
      .row { display: flex; gap: 12px; flex-wrap: wrap; margin: 16px 0; }
      button { border: 0; background: #2563eb; color: white; border-radius: 10px; padding: 10px 16px; font-weight: 600; cursor: pointer; }
      button:disabled { opacity: 0.5; cursor: not-allowed; }
      pre { white-space: pre-wrap; line-height: 1.5; padding: 16px; border-radius: 10px; background: #f9fafb; border: 1px solid #e5e7eb; min-height: 160px; }
      img { max-width: 100%; max-height: 320px; border-radius: 12px; margin-top: 8px; }
    </style>
  </head>
  <body>
    <main class="card">
      <h1>牙齿 AI 检测助手</h1>
      <p class="hint">上传牙齿照片后，系统会在后端调用 AI 接口进行分析，前端不会暴露你的 API Key。</p>
      <div class="row">
        <input id="photo" type="file" accept="image/*" />
        <button id="analyzeBtn">上传并分析</button>
      </div>
      <img id="preview" alt="预览图" hidden />
      <h3>分析结果</h3>
      <pre id="result">等待上传图片...</pre>
    </main>

    <script>
      const photoInput = document.getElementById('photo');
      const analyzeBtn = document.getElementById('analyzeBtn');
      const result = document.getElementById('result');
      const preview = document.getElementById('preview');
      let imageDataUrl = '';

      photoInput.addEventListener('change', () => {
        const file = photoInput.files?.[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = () => {
          imageDataUrl = String(reader.result || '');
          preview.src = imageDataUrl;
          preview.hidden = false;
        };
        reader.readAsDataURL(file);
      });

      analyzeBtn.addEventListener('click', async () => {
        if (!imageDataUrl) {
          result.textContent = '请先选择一张牙齿照片。';
          return;
        }

        analyzeBtn.disabled = true;
        result.textContent = 'AI 正在分析中，请稍候...';

        try {
          const resp = await fetch('/api/analyze', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ imageDataUrl })
          });

          const data = await resp.json();
          if (!resp.ok) throw new Error(data.error || '请求失败');

          result.textContent = data.result;
        } catch (err) {
          result.textContent = `分析失败：${err.message}`;
        } finally {
          analyzeBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>
